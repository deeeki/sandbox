<?php
class MobileDevice {
	public static $unsupported_devices = array(
//AU
		'701G' => '701G',
		'702G' => '702G',
		'703G' => '703G',
		'704G' => '704G',
		'705G' => '705G',
		'ST13' => 'A1011ST',
		'KC14' => 'A1012K',
		'KC14' => 'A1012KII',
		'KC15' => 'A1013K',
		'ST14' => 'A1014ST',
		'SN22' => 'A1101S',
		'SN23' => 'A1301S',
		'SA24' => 'A1302SA',
		'SA25' => 'A1303SA',
		'TS25' => 'A1304T',
		'TS25' => 'A1304T(カメラ無)',
		'TS25' => 'A1304TII',
		'SA28' => 'A1305SA',
		'KC23' => 'A1401K',
		'SN27' => 'A1402S',
		'SN27' => 'A1402SII',
		'SN28' => 'A1402SII(カメラ無)',
		'KC26' => 'A1403K',
		'SN29' => 'A1404S',
		'SN29' => 'A1404SII',
		'PT21' => 'A1405PT',
		'A1406PT' => 'A1406PT',
		'A1407PT' => 'A1407PT',
		'SA21' => 'A3011SA',
		'CA21' => 'A3012CA',
		'TS22' => 'A3013T',
		'SN21' => 'A3014S',
		'SA22' => 'A3015SA',
		'TS23' => 'A5301T',
		'CA22' => 'A5302CA',
		'HI23' => 'A5303H',
		'HI24' => 'A5303HII',
		'TS24' => 'A5304T',
		'KC22' => 'A5305K',
		'ST21' => 'A5306ST',
		'CA23' => 'A5401CA',
		'CA23' => 'A5401CAII',
		'SN24' => 'A5402S',
		'CA24' => 'A5403CA',
		'SN25' => 'A5404S',
		'ST23' => 'A5405SA',
		'CA25' => 'A5406CA',
		'CA26' => 'A5407CA',
		'TS26' => 'A5501T',
		'KC24' => 'A5502K',
		'SA26' => 'A5503SA',
		'TS27' => 'A5504T',
		'SA27' => 'A5505SA',
		'TS28' => 'A5506T',
		'ST24' => 'A5507SA',
		'TS29' => 'A5509T',
		'TS2A' => 'A5511T',
		'CA27' => 'A5512CA',
		'ST27' => 'A5514SA',
		'KC27' => 'A5515K',
		'TS2B' => 'A5516T',
		'TS2C' => 'A5517T',
		'ST28' => 'A5518SA',
		'ST28' => 'A5518SA(カメラ無)',
		'ST2A' => 'A5520SA',
		'ST2A' => 'A5520SAII',
		'KC28' => 'A5521K',
		'SA29' => 'A5522SA',
		'SA2A' => 'A5527SA',
		'B01K' => 'B01K',
		'SY15' => 'C1001SA',
		'SN17' => 'C1002S',
		'C201H' => 'C201H',
		'C202DE' => 'C202DE',
		'HI21' => 'C3001H',
		'KC21' => 'C3002K',
		'MA21' => 'C3003P',
		'C301T' => 'C301T',
		'C302H' => 'C302H',
		'C303CA' => 'C303CA',
		'C304SA' => 'C304SA',
		'C305S' => 'C305S',
		'C307K' => 'C307K',
		'C308P' => 'C308P',
		'C309H' => 'C309H',
		'C310T' => 'C310T',
		'C311CA' => 'C311CA',
		'C313K' => 'C313K',
		'SY12' => 'C401SA',
		'DN11' => 'C402DE',
		'ST11' => 'C403ST',
		'SN12' => 'C404S',
		'SY13' => 'C405SA',
		'SN13' => 'C406S',
		'HI13' => 'C407H',
		'MA13' => 'C408P',
		'CA13' => 'C409CA',
		'TS13' => 'C410T',
		'ST12' => 'C411ST',
		'SY14' => 'C412SA',
		'SN15' => 'C413S',
		'KC13' => 'C414K',
		'C414KII' => 'C414KII',
		'TS14' => 'C415T',
		'HI14' => 'C451H',
		'CA14' => 'C452CA',
		'TS21' => 'C5001T',
		'D301SA' => 'D301SA',
		'D302T' => 'D302T',
		'D303K' => 'D303K',
		'D304K' => 'D304K',
		'D305P' => 'D305P',
		'D306S' => 'D306S',
		'SA37' => 'E02SA',
		'CA36' => 'E03CA',
//		'E30HT' => 'E30HT',
		'CA28' => 'G'zOne TYPE-R',
		'CA34' => 'G'zOne W42CA',
		'ST22' => 'INFOBAR',
//		'IS01' => 'IS01',
		'TS34' => 'MUSIC-HDD W41T',
		'TS35' => 'neon',
		'HI34' => 'PENCK',
		'ST26' => 'Sweets',
		'ST29' => 'Sweets pure',
		'ST25' => 'talby',
		'HI31' => 'W11H',
		'KC31' => 'W11K',
		'CA31' => 'W21CA',
		'CA31' => 'W21CAII',
		'HI32' => 'W21H',
		'KC32' => 'W21K',
		'SN31' => 'W21S',
		'SA31' => 'W21SA',
		'TS31' => 'TS31',
		'HI33' => 'W22H',
		'SA32' => 'W22SA',
		'CA32' => 'W31CA',
		'KC33' => 'W31K',
		'KC33' => 'W31KII',
		'SN32' => 'W31S',
		'SA33' => 'W31SA',
		'SA33' => 'W31SAII',
		'TS32' => 'W31T',
		'HI35' => 'W32H',
		'KC34' => 'W32K',
		'SN33' => 'W32S',
		'SA34' => 'W32SA',
		'TS33' => 'W32T',
		'SA35' => 'W33SA',
		'SA35' => 'W33SAII',
		'CA33' => 'W41CA',
		'HI36' => 'W41H',
		'KC35' => 'W41K',
		'SN34' => 'W41S',
		'SA36' => 'W41SA',
		'SH31' => 'W41SH',
		'HI37' => 'W42H',
		'KC36' => 'W42K',
		'SN36' => 'W42S',
		'TS36' => 'W43T',
		'W44T' => 'W44T',
//DoCoMo
		'633S' => '633S',
		'641P' => '641P',
		'641Sf' => '641Sf',
		'641Ss' => '641Ss',
		'642S' => '642S',
//		'BlackBerry 8707h' => 'BlackBerry 8707h',
//		'BlackBerry Bold' => 'BlackBerry Bold',
//		'BlackBerry Bold 9700' => 'BlackBerry Bold 9700',
//		'BlackBerry Curve 9300' => 'BlackBerry Curve 9300',
		'D209i' => 'D209i',
		'D2101V' => 'D2101V',
		'D210i' => 'D210i',
		'D211i' => 'D211i',
		'D251i' => 'D251i',
		'D251iS' => 'D251iS',
		'D252i' => 'D252i',
		'D253i' => 'D253i',
		'D501i' => 'D501i',
		'D502i' => 'D502i',
		'D503i' => 'D503i',
		'D503iS' => 'D503iS',
		'D504i' => 'D504i',
		'D505i' => 'D505i',
		'D505iS' => 'D505iS',
		'D506i' => 'D506i',
		'D701i' => 'D701i',
		'D702i' => 'D702i',
		'D702iBCL' => 'D702iBCL',
		'D702iF' => 'D702iF',
		'D703i' => 'D703i',
		'D704i' => 'D704i',
		'D705i' => 'D705i',
		'D705iμ' => 'D705iμ',
		'D800iDS' => 'D800iDS',
		'D900i' => 'D900i',
		'D901i' => 'D901i',
		'D901iS' => 'D901iS',
		'D902i' => 'D902i',
		'D902iS' => 'D902iS',
		'D903i' => 'D903i',
		'D903iTV' => 'D903iTV',
		'D904i' => 'D904i',
		'DOLCE' => 'DOLCE',
		'DOLCE SL' => 'DOLCE SL',
		'ER209i' => 'ER209i',
		'F-05A' => 'F-05A',
//		'F1100' => 'F1100',
		'F2051' => 'F2051',
		'F209i' => 'F209i',
		'F2102V' => 'F2102V',
		'F210i' => 'F210i',
		'F211i' => 'F211i',
		'F212i' => 'F212i',
		'F251i' => 'F251i',
		'F501i' => 'F501i',
		'F502i' => 'F502i',
		'F502it' => 'F502it',
		'F503i' => 'F503i',
		'F503iS' => 'F503iS',
		'F504i' => 'F504i',
		'F504iS' => 'F504iS',
		'F505i' => 'F505i',
		'F505iGPS' => 'F505iGPS',
		'F506i' => 'F506i',
		'F661i' => 'F661i',
		'F671i' => 'F671i',
		'F671iS' => 'F671iS',
		'F672i' => 'F672i',
		'F700i' => 'F700i',
		'F700iS' => 'F700iS',
		'F702iD' => 'F702iD',
		'F703i' => 'F703i',
		'F704i' => 'F704i',
		'F705i' => 'F705i',
		'F801i' => 'F801i',
		'F880iES' => 'F880iES',
		'F881iES' => 'F881iES',
		'F882iES' => 'F882iES',
		'F883i' => 'F883i',
		'F883iES' => 'F883iES',
		'F883iESS' => 'F883iESS',
		'F883iS' => 'F883iS',
		'F900i' => 'F900i',
		'F900iC' => 'F900iC',
		'F900iT' => 'F900iT',
		'F901iC' => 'F901iC',
		'F901iS' => 'F901iS',
		'F902i' => 'F902i',
		'F902iS' => 'F902iS',
		'F903i' => 'F903i',
		'F903iBSC' => 'F903iBSC',
		'F903iX HIGH-SPEED' => 'F903iX HIGH-SPEED',
		'F904i' => 'F904i',
//		'HT-01A' => 'HT-01A',
//		'HT-02A' => 'HT-02A',
//		'HT-03A' => 'HT-03A',
//		'HT1100' => 'HT1100',
//		'hTc Z' => 'hTc Z',
		'KO209i' => 'KO209i',
		'KO210i' => 'KO210i',
		'L-01A' => 'L-01A',
		'L-01C' => 'L-01C',
		'L-02B' => 'L-02B',
		'L-03A' => 'L-03A',
		'L-03B' => 'L-03B',
		'L-04A' => 'L-04A',
		'L-04B' => 'L-04B',
		'L-06A' => 'L-06A',
		'L704i' => 'L704i',
		'L705i' => 'L705i',
		'L705iX' => 'L705iX',
		'L706ie' => 'L706ie',
		'L852i' => 'L852i',
		'Lechiffon' => 'Lechiffon',
		'M702iG' => 'M702iG',
		'M702iS' => 'M702iS',
		'Music PORTER' => 'Music PORTER',
		'Music Porter II' => 'Music Porter II',
		'Music Porter X' => 'Music Porter X',
		'N-03C' => 'N-03C',
		'N2001' => 'N2001',
		'N2002' => 'N2002',
		'N2051' => 'N2051',
		'N209i' => 'N209i',
		'N2102V' => 'N2102V',
		'N210i' => 'N210i',
		'N211i' => 'N211i',
		'N211iS' => 'N211iS',
		'N251i' => 'N251i',
		'N251iS' => 'N251iS',
		'N252i' => 'N252i',
		'N253i' => 'N253i',
		'N2701' => 'N2701',
		'N501i' => 'N501i',
		'N502i' => 'N502i',
		'N502it' => 'N502it',
		'N503i' => 'N503i',
		'N503iS' => 'N503iS',
		'N504i' => 'N504i',
		'N504iS' => 'N504iS',
		'N505i' => 'N505i',
		'N505iS' => 'N505iS',
		'N506i' => 'N506i',
		'N506iS' => 'N506iS',
		'N506iSII' => 'N506iSII',
		'N700i' => 'N700i',
		'N701i' => 'N701i',
		'N701iECO' => 'N701iECO',
		'N702iD' => 'N702iD',
		'N702iS' => 'N702iS',
		'N703iD' => 'N703iD',
		'N703iμ' => 'N703iμ',
		'N704iμ' => 'N704iμ',
		'N821i' => 'N821i',
		'N900i' => 'N900i',
		'N900iG' => 'N900iG',
		'N900iL' => 'N900iL',
		'N900iS' => 'N900iS',
		'N901iC' => 'N901iC',
		'N901iS' => 'N901iS',
		'N902i' => 'N902i',
		'N902iL' => 'N902iL',
		'N902iS' => 'N902iS',
		'N902iX HIGH-SPEED' => 'N902iX HIGH-SPEED',
		'N903i' => 'N903i',
		'N904i' => 'N904i',
		'NM502i' => 'NM502i',
		'NM705i' => 'NM705i',
		'NM706i' => 'NM706i',
		'NM850iG' => 'NM850iG',
		'P2002' => 'P2002',
		'P209i' => 'P209i',
		'P209iS' => 'P209iS',
		'P2101V' => 'P2101V',
		'P2102V' => 'P2102V',
		'P210i' => 'P210i',
		'P211i' => 'P211i',
		'P211iS' => 'P211iS',
		'P251iS' => 'P251iS',
		'P252i' => 'P252i',
		'P252iS' => 'P252iS',
		'P253i' => 'P253i',
		'P501i' => 'P501i',
		'P502i' => 'P502i',
		'P503i' => 'P503i',
		'P503iS' => 'P503iS',
		'P504i' => 'P504i',
		'P504iS' => 'P504iS',
		'P505i' => 'P505i',
		'P505iS' => 'P505iS',
		'P506iC' => 'P506iC',
		'P506iCII' => 'P506iCII',
		'P700i' => 'P700i',
		'P701iD' => 'P701iD',
		'P702i' => 'P702i',
		'P702iD' => 'P702iD',
		'P703i' => 'P703i',
		'P703iμ' => 'P703iμ',
		'P704i' => 'P704i',
		'P704iμ' => 'P704iμ',
		'P751v' => 'P751v',
		'P821i' => 'P821i',
		'P900i' => 'P900i',
		'P900iV' => 'P900iV',
		'P901i' => 'P901i',
		'P901iS' => 'P901iS',
		'P901iTV' => 'P901iTV',
		'P902i' => 'P902i',
		'P902iS' => 'P902iS',
		'P903i' => 'P903i',
		'P903iTV' => 'P903iTV',
		'P903iX HIGH-SPEED' => 'P903iX HIGH-SPEED',
		'P904i' => 'P904i',
		'premini' => 'premini',
		'premini-II' => 'premini-II',
		'premini-IIS' => 'premini-IIS',
		'premini-S' => 'premini-S',
		'prosolid' => 'prosolid',
		'prosolidII' => 'prosolidII',
		'R209i' => 'R209i',
		'R211i' => 'R211i',
		'R691i' => 'R691i',
		'R692i' => 'R692i',
		'RADIDEN' => 'RADIDEN',
		'SA700iS' => 'SA700iS',
		'SA702i' => 'SA702i',
		'SA800i' => 'SA800i',
//		'SH-10B' => 'SH-10B',
		'SH2101V' => 'SH2101V',
		'SH251i' => 'SH251i',
		'SH251iS' => 'SH251iS',
		'SH252i' => 'SH252i',
		'SH505i' => 'SH505i',
		'SH505iS' => 'SH505iS',
		'SH506iC' => 'SH506iC',
		'SH700i' => 'SH700i',
		'SH700iS' => 'SH700iS',
		'SH702iD' => 'SH702iD',
		'SH702iS' => 'SH702iS',
		'SH703i' => 'SH703i',
		'SH704i' => 'SH704i',
		'SH705i' => 'SH705i',
		'SH705iII' => 'SH705iII',
		'SH706ie' => 'SH706ie',
		'SH712m' => 'SH712m',
		'SH821i' => 'SH821i',
		'SH900i' => 'SH900i',
		'SH901iC' => 'SH901iC',
		'SH901iS' => 'SH901iS',
		'SH902i' => 'SH902i',
		'SH902iS' => 'SH902iS',
		'SH903i' => 'SH903i',
		'SH903iTV' => 'SH903iTV',
		'SH904i' => 'SH904i',
		'SIMPURE L' => 'SIMPURE L',
		'SIMPURE L1' => 'SIMPURE L1',
		'SIMPURE L2' => 'SIMPURE L2',
		'SIMPURE N' => 'SIMPURE N',
		'SIMPURE N1' => 'SIMPURE N1',
		'SO210i' => 'SO210i',
		'SO211i' => 'SO211i',
		'SO212i' => 'SO212i',
		'SO502i' => 'SO502i',
		'SO502iWM' => 'SO502iWM',
		'SO503i' => 'SO503i',
		'SO503iS' => 'SO503iS',
		'SO504i' => 'SO504i',
		'SO505i' => 'SO505i',
		'SO505iS' => 'SO505iS',
		'SO506iC' => 'SO506iC',
		'SO702i' => 'SO702i',
		'SO703i' => 'SO703i',
		'SO704i' => 'SO704i',
		'SO902i' => 'SO902i',
		'SO902iWP+' => 'SO902iWP+',
		'SO903i' => 'SO903i',
		'SO903iTV' => 'SO903iTV',
		'T2101V' => 'T2101V',
//		'Xperia' => 'Xperia',
//SoftBank
		'001SC' => '001SC',
		'003Z' => '003Z',
		'201SH' => '201SH',
		'304T' => '304T',
//		'304T(カメラ無)' => '304T(カメラ無)',
		'702MO' => '702MO',
		'702NK' => '702NK',
		'702NKII' => '702NKII',
		'702sMO' => '702sMO',
		'703N' => '703N',
		'703SH' => '703SH',
		'703SHf' => '703SHf',
		'705N' => '705N',
		'705NK' => '705NK',
		'705P' => '705P',
		'705Px' => '705Px',
		'705SC' => '705SC',
		'705SH SLIMIA' => '705SH SLIMIA',
		'705T' => '705T',
		'706N' => '706N',
		'706P' => '706P',
		'706SC' => '706SC',
		'707SC' => '707SC',
		'707SCII' => '707SCII',
		'708SC' => '708SC',
		'709SC' => '709SC',
		'731SC' => '731SC',
		'740SC' => '740SC',
		'802N' => '802N',
		'802SE' => '802SE',
		'802SH' => '802SH',
		'803T' => '803T',
		'804N' => '804N',
		'804NK' => '804NK',
		'804SH' => '804SH',
		'804SS' => '804SS',
		'805SC' => '805SC',
		'830SC' => '830SC',
		'902SH' => '902SH',
		'902T' => '902T',
		'903SH' => '903SH',
		'903T' => '903T',
		'904SH' => '904SH',
		'904T' => '904T',
		'905SH' => '905SH',
//		'iPhone 3G' => 'iPhone 3G',
//		'iPhone 3GS' => 'iPhone 3GS',
//		'iPhone 4' => 'iPhone 4',
		'J-D03' => 'J-D03',
		'J-D04' => 'J-D04',
		'J-D05' => 'J-D05',
		'J-D06' => 'J-D06',
		'J-D07' => 'J-D07',
		'J-D08' => 'J-D08',
		'J-D31' => 'J-D31',
		'J-DN02' => 'J-DN02',
		'J-DN03' => 'J-DN03',
		'J-K03' => 'J-K03',
		'J-K04' => 'J-K04',
		'J-K05' => 'J-K05',
		'J-K51' => 'J-K51',
		'J-N03' => 'J-N03',
		'J-N03II' => 'J-N03II',
		'J-N04' => 'J-N04',
		'J-N05' => 'J-N05',
		'J-N51' => 'J-N51',
		'J-NM01' => 'J-NM01',
		'J-NM02' => 'J-NM02',
		'J-P02' => 'J-P02',
		'J-P03' => 'J-P03',
		'J-P51' => 'J-P51',
		'J-PE03' => 'J-PE03',
		'J-PE03II' => 'J-PE03II',
		'J-SA02' => 'J-SA02',
		'J-SA03' => 'J-SA03',
		'J-SA04' => 'J-SA04',
		'J-SA05' => 'J-SA05',
		'J-SA06' => 'J-SA06',
		'J-SA51' => 'J-SA51',
		'J-SH010' => 'J-SH010',
		'J-SH02' => 'J-SH02',
		'J-SH03' => 'J-SH03',
		'J-SH04' => 'J-SH04',
		'J-SH04B' => 'J-SH04B',
		'J-SH05' => 'J-SH05',
		'J-SH06' => 'J-SH06',
		'J-SH07' => 'J-SH07',
		'J-SH08' => 'J-SH08',
		'J-SH09' => 'J-SH09',
		'J-SH51' => 'J-SH51',
		'J-SH52' => 'J-SH52',
		'J-SH53' => 'J-SH53',
		'J-T010' => 'J-T010',
		'J-T04' => 'J-T04',
		'J-T05' => 'J-T05',
		'J-T06' => 'J-T06',
		'J-T07' => 'J-T07',
		'J-T08' => 'J-T08',
		'J-T09' => 'J-T09',
		'J-T51' => 'J-T51',
		'V101D' => 'V101D',
		'V102D' => 'V102D',
		'V301D' => 'V301D',
		'V301SH' => 'V301SH',
		'V301T' => 'V301T',
		'V302SH' => 'V302SH',
		'V302T' => 'V302T',
		'V303T' => 'V303T',
		'V401D' => 'V401D',
		'V401SA' => 'V401SA',
		'V401SH' => 'V401SH',
		'V401T' => 'V401T',
		'V402SH' => 'V402SH',
		'V403SH' => 'V403SH',
		'V501SH' => 'V501SH',
		'V501T' => 'V501T',
		'V502T' => 'V502T',
		'V601N' => 'V601N',
		'V601SH' => 'V601SH',
		'V601T' => 'V601T',
		'V602SH' => 'V602SH',
		'V602T' => 'V602T',
		'V603SH' => 'V603SH',
		'V603T' => 'V603T',
		'V604SH' => 'V604SH',
		'V604T' => 'V604T',
		'V801SA' => 'V801SA',
		'V801SH' => 'V801SH',
		'X01HT' => 'X01HT',
		'X01NK' => 'X01NK',
		'X02HT' => 'X02HT',
		'X03HT' => 'X03HT',
		'X04HT' => 'X04HT',
		'X05HT' => 'X05HT',
	);

	/**
	 * Flash Lite2.0未満の非対応機種ならtrueを返します
	 *
	 * @param	string	$user_agent
	 * @return	boolean
	 */
	public static function is_unsupported($user_agent = null) {
		$device_name = self::detect($user_agent);
		return isset(self::$unsupported_devices[$device_name]);
	}

	/**
	 * UserAgentよりデバイス名を返します
	 *
	 * @param	string	$user_agent
	 * @return	string
	 */
	public static function detect($user_agent = null) {
		if (!isset($user_agent)) {
			$user_agent = $_SERVER['HTTP_USER_AGENT'];
		}
		$device_name = '';
		//DoCoMo
		if (preg_match('!^DoCoMo/1!', $user_agent)) {
			if (preg_match('!1\.0/([-_.a-zA-Z0-9]+)(/c(\d+)(/\w+)*?(/ser(\w+))?)?!', $user_agent, $specs)) {
				$device_name  = $specs[1];
			}
		}
		elseif (preg_match('!^DoCoMo/2!', $user_agent)) {
			if (preg_match('/\(c(\d+);/', $user_agent, $cache) && $cache[1] >= 500) {
				if (preg_match('!2\.\d ([-_.a-zA-Z0-9]+)\(c(\d+)(;\w+)*?(;ser(\w+);icc(\w+))?\)!', $user_agent, $specs)) {
				$device_name  = $specs[1];
				}
			} else {
				if (preg_match('!2\.\d ([-_.a-zA-Z0-9]+)\(c(\d+)(;\w+)*?(;ser(\w+);icc(\w+))?\)!', $user_agent, $specs)) {
				$device_name  = $specs[1];
				}
			}
		}
		//Softbank
		elseif (preg_match('!^(J\-PHONE/|Vodafone/|SoftBank/)!', $user_agent)) {
			if (preg_match('!^(J\-PHONE|Vodafone|SoftBank)/\d\.\d+/([-_.a-zA-Z0-9]+)/[-_.a-zA-Z0-9]+(/SN([-_.a-zA-Z0-9]*) )?!', $user_agent, $specs)) {
				$device_name = $specs[2];
			}
		}
		//AU
		elseif (preg_match('/^KDDI-/',$user_agent)) {
			if (preg_match('!^KDDI-([A-Za-z0-9]+) !', $user_agent, $specs)) {
				$device_name = $specs[1];
			}
		}
		return $device_name;
	}
}
